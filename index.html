<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½çè¼ªç›¤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .left-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 100%;
        }

        .wheel-results-panel {
            background: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            width: 420px;
            height: fit-content;
            border: 1px solid #f0f0f0;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .participants-input {
            margin-bottom: 10px;
        }

        .participant-entry {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .participant-entry input[type="text"] {
            flex: 1;
        }

        .participant-entry input[type="number"] {
            width: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .participant-buttons {
            display: flex;
            gap: 5px;
        }

        .remove-btn, .disable-btn {
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            width: 40px;
            font-weight: bold;
        }

        .remove-btn {
            background: #ff4757;
        }

        .remove-btn:hover {
            background: #ff3838;
        }

        .disable-btn {
            background: #ffa502;
        }

        .disable-btn:hover {
            background: #ff9f43;
        }

        .disable-btn.active {
            background: #747d8c;
        }

        .disable-btn.active:hover {
            background: #57606f;
        }

        .participant-entry.disabled {
            opacity: 0.5;
            background-color: #f8f9fa;
        }

        .participant-entry.disabled input {
            background-color: #e9ecef !important;
            color: #6c757d !important;
            cursor: not-allowed !important;
        }

        .participant-entry.disabled input:disabled {
            background-color: #e9ecef;
            color: #6c757d;
            border-color: #dee2e6;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .add-participant, .enable-all, .clear-all {
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            flex: 1;
        }

        .add-participant {
            background: #2ed573;
        }

        .add-participant:hover {
            background: #26c464;
        }

        .enable-all {
            background: #3742fa;
        }

        .enable-all:hover {
            background: #2f3542;
        }

        .clear-all {
            background: #ff6b6b;
        }

        .clear-all:hover {
            background: #ee5a52;
        }

        .wheel-section {
            display: flex;
            gap: 80px;
            align-items: flex-start;
            margin: 50px 0;
            justify-content: center;
            padding: 0 20px;
        }

        .wheel-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .wheel-wrapper {
            position: relative;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        #wheel {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            border: 8px solid #333;
            position: relative;
        }

        .pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 60px solid #ff4757;
            z-index: 10;
        }

        .spin-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .spin-btn:hover {
            transform: scale(1.05);
        }

        .spin-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #2d3436;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .results-panel {
            margin-top: 0;
        }

        .results-panel h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        #results-text {
            width: 100%;
            min-height: 280px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Arial', sans-serif;
            font-size: 16px;
            line-height: 1.5;
            resize: vertical;
            background: #f8f9fa;
            color: #333;
            margin-bottom: 15px;
        }

        #results-text:focus {
            outline: none;
            border-color: #667eea;
        }

        .results-buttons {
            display: flex;
            gap: 10px;
        }

        .clear-results {
            background: #ff4757;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            flex: 1;
        }

        .clear-results:hover {
            background: #ff3838;
        }

        .copy-results {
            background: #2ed573;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            flex: 1;
        }

        .copy-results:hover {
            background: #26c464;
        }

        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: #666;
            font-size: 14px;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 1200px) {
            .wheel-section {
                flex-direction: column;
                align-items: center;
                gap: 40px;
                padding: 0 10px;
            }
            
            .wheel-results-panel {
                width: 100%;
                max-width: 500px;
            }
        }

        @media (max-width: 600px) {
            .left-panel {
                padding: 20px;
            }
            
            .wheel-results-panel {
                padding: 20px;
            }
            
            #wheel {
                width: 300px;
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="left-panel">
        <h1 id="lottery-title">åš•æ¯›å¤§è»ç©ºæŠ•è¼ªç›¤</h1>
        
        <div class="instructions">
            <strong>ä½¿ç”¨èªªæ˜ï¼š</strong>
            <ul>
                <li>è¼¸å…¥çé …åç¨±</li>
                <li>æ·»åŠ åƒèˆ‡è€…å§“åå’Œæ¬Šé‡ï¼ˆæ¬Šé‡è¶Šé«˜ï¼Œä¸­çæ©Ÿç‡è¶Šå¤§ï¼‰</li>
                <li>é»æ“Šã€Œé–‹å§‹æŠ½çã€æŒ‰éˆ•é€²è¡ŒæŠ½ç</li>
            </ul>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label for="title-input">çé …åç¨±ï¼š</label>
                <input type="text" id="title-input" placeholder="è¼¸å…¥çé …åç¨±">
            </div>

            <div class="input-group">
                <label>åƒèˆ‡è€…ï¼ˆå§“å + æ¬Šé‡ï¼‰ï¼š</label>
                <div id="participants-container">
                    <div class="participant-entry">
                        <input type="text" placeholder="åƒèˆ‡è€…å§“å">
                        <input type="number" placeholder="æ¬Šé‡" value="1" min="1">
                        <div class="participant-buttons">
                            <button class="disable-btn" onclick="toggleParticipant(this)" title="åœç”¨/å•Ÿç”¨åƒèˆ‡è€…">âˆ’</button>
                            <button class="remove-btn" onclick="removeParticipant(this)" title="åˆªé™¤åƒèˆ‡è€…">Ã—</button>
                        </div>
                    </div>
                </div>
                <div class="control-buttons">
                    <button class="add-participant" onclick="addParticipant()">+ æ·»åŠ åƒèˆ‡è€…</button>
                    <button class="enable-all" onclick="enableAllParticipants()">å…¨éƒ¨ +</button>
                    <button class="clear-all" onclick="clearAllParticipants()">æ¸…ç©ºå…¨éƒ¨</button>
                </div>
            </div>
        </div>

        <div class="wheel-section">
            <div class="wheel-container">
                <div class="wheel-wrapper">
                    <div class="pointer"></div>
                    <canvas id="wheel" width="400" height="400"></canvas>
                </div>
                <button class="spin-btn" onclick="spinWheel()">ç”¨ï¼µç ¸æˆ‘</button>
            </div>
            
            <div class="wheel-results-panel">
                <div class="results-panel">
                    <div class="result" id="result">ç­‰å¾…æŠ½ççµæœ...</div>
                    <h2>æŠ½ççµæœ</h2>
                    <textarea id="results-text" readonly placeholder="ç­‰å¾…æŠ½ççµæœ...&#13;&#10;&#13;&#10;çé …åç¨±æœƒé¡¯ç¤ºåœ¨ç¬¬ä¸€è¡Œ&#13;&#10;ä¸­çè€…æœƒä¾åºåˆ—å‡º"></textarea>
                    <div class="results-buttons">
                        <button class="clear-results" onclick="clearResults()">æ¸…é™¤å…¨éƒ¨</button>
                        <button class="copy-results" onclick="copyResults()">è¤‡è£½</button>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script>
        let isSpinning = false;
        let wheel = document.getElementById('wheel');
        let canvas = wheel;
        let ctx = canvas.getContext('2d');

        // æ›´æ–°æ¨™é¡Œï¼ˆåƒ…ç”¨æ–¼å³å´çµæœé¢æ¿ï¼Œä¸å½±éŸ¿é é¢ä¸»æ¨™é¡Œï¼‰
        function updateTitle() {
            // é é¢ä¸»æ¨™é¡Œä¿æŒå›ºå®šç‚ºã€Œåš•æ¯›å¤§è»ç©ºæŠ•è¼ªç›¤ã€ï¼Œä¸åšä»»ä½•ä¿®æ”¹
            // æ­¤å‡½æ•¸ç¾åœ¨åƒ…ç”¨æ–¼å…¶ä»–éœ€è¦çš„åœ°æ–¹
        }

        // ç›£è½æ¨™é¡Œè¼¸å…¥
        document.getElementById('title-input').addEventListener('input', updateTitle);

        // æ·»åŠ åƒèˆ‡è€…
        function addParticipant() {
            const container = document.getElementById('participants-container');
            const entry = document.createElement('div');
            entry.className = 'participant-entry';
            entry.innerHTML = `
                <input type="text" placeholder="åƒèˆ‡è€…å§“å">
                <input type="number" placeholder="æ¬Šé‡" value="1" min="1">
                <div class="participant-buttons">
                    <button class="disable-btn" onclick="toggleParticipant(this)" title="åœç”¨/å•Ÿç”¨åƒèˆ‡è€…">âˆ’</button>
                    <button class="remove-btn" onclick="removeParticipant(this)" title="åˆªé™¤åƒèˆ‡è€…">Ã—</button>
                </div>
            `;
            container.appendChild(entry);
            
            // ç‚ºæ–°æ·»åŠ çš„è¼¸å…¥æ¡†æ·»åŠ äº‹ä»¶ç›£è½å™¨
            const inputs = entry.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', drawWheel);
            });
            
            // å³æ™‚æ›´æ–°è¼ªç›¤
            drawWheel();
        }

        // ç§»é™¤åƒèˆ‡è€…
        function removeParticipant(button) {
            const entries = document.querySelectorAll('.participant-entry');
            if (entries.length > 1) {
                button.closest('.participant-entry').remove();
                // å³æ™‚æ›´æ–°è¼ªç›¤
                drawWheel();
            } else {
                alert('è‡³å°‘éœ€è¦ä¸€å€‹åƒèˆ‡è€…ï¼');
            }
        }

        // åœç”¨/å•Ÿç”¨åƒèˆ‡è€…
        function toggleParticipant(button) {
            const entry = button.closest('.participant-entry');
            const isDisabled = entry.classList.contains('disabled');
            
            if (isDisabled) {
                // å•Ÿç”¨åƒèˆ‡è€…
                entry.classList.remove('disabled');
                button.classList.remove('active');
                button.textContent = 'âˆ’';
                button.title = 'åœç”¨/å•Ÿç”¨åƒèˆ‡è€…';
                
                // å•Ÿç”¨è¼¸å…¥æ¡†
                const inputs = entry.querySelectorAll('input');
                inputs.forEach(input => {
                    input.disabled = false;
                });
            } else {
                // åœç”¨åƒèˆ‡è€…
                entry.classList.add('disabled');
                button.classList.add('active');
                button.textContent = '+';
                button.title = 'å•Ÿç”¨åƒèˆ‡è€…';
                
                // åœç”¨è¼¸å…¥æ¡†
                const inputs = entry.querySelectorAll('input');
                inputs.forEach(input => {
                    input.disabled = true;
                });
            }
            
            // å³æ™‚æ›´æ–°è¼ªç›¤
            drawWheel();
        }

        // ç²å–åƒèˆ‡è€…æ•¸æ“šï¼ˆåªåŒ…å«å•Ÿç”¨çš„åƒèˆ‡è€…ï¼‰
        function getParticipants() {
            const entries = document.querySelectorAll('.participant-entry:not(.disabled)');
            const participants = [];
            
            entries.forEach(entry => {
                const name = entry.querySelector('input[type="text"]').value.trim();
                const weight = parseInt(entry.querySelector('input[type="number"]').value) || 1;
                
                if (name) {
                    participants.push({ name, weight });
                }
            });
            
            return participants;
        }

        // ç¹ªè£½è¼ªç›¤
        function drawWheel() {
            const participants = getParticipants();
            if (participants.length === 0) {
                // å¦‚æœæ²’æœ‰åƒèˆ‡è€…ï¼Œæ¸…ç©ºç•«å¸ƒ
                ctx.clearRect(0, 0, 400, 400);
                ctx.fillStyle = '#f0f0f0';
                ctx.beginPath();
                ctx.arc(200, 200, 192, 0, 2 * Math.PI);
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 8;
                ctx.stroke();
                
                ctx.fillStyle = '#999';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('è«‹æ·»åŠ åƒèˆ‡è€…', 200, 200);
                return;
            }

            const totalWeight = participants.reduce((sum, p) => sum + p.weight, 0);
            let currentAngle = 0;
            
            // æ¸…ç©ºç•«å¸ƒ
            ctx.clearRect(0, 0, 400, 400);
            
            // é¡è‰²é™£åˆ—
            const colors = [
                '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
                '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9',
                '#F8C471', '#82E0AA', '#F1948A', '#85C1E9', '#D2B4DE'
            ];

            // æ ¹æ“šåƒèˆ‡è€…æ•¸é‡å‹•æ…‹èª¿æ•´å­—é«”å¤§å°
            let fontSize;
            if (participants.length <= 3) {
                fontSize = 24;
            } else if (participants.length <= 6) {
                fontSize = 20;
            } else if (participants.length <= 10) {
                fontSize = 16;
            } else {
                fontSize = 14;
            }

            participants.forEach((participant, index) => {
                const sliceAngle = (participant.weight / totalWeight) * 2 * Math.PI;
                
                // ç¹ªè£½æ‰‡å½¢
                ctx.beginPath();
                ctx.moveTo(200, 200);
                ctx.arc(200, 200, 192, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = colors[index % colors.length];
                ctx.fill();
                // ç§»é™¤ç™½è‰²é‚Šæ¡†ä»¥é¿å…ä¸­ççˆ­è­°

                // ç¹ªè£½æ–‡å­— - æ™ºèƒ½é¡¯ç¤º
                const textAngle = currentAngle + sliceAngle / 2;
                let displayText = participant.name;
                let textFontSize = fontSize;
                
                // æ ¹æ“šæ‰‡å½¢å¤§å°æ±ºå®šé¡¯ç¤ºç­–ç•¥
                const isSmallSlice = sliceAngle < Math.PI / 8; // å°æ–¼22.5åº¦
                const isNarrowSlice = sliceAngle < Math.PI / 4; // å°æ–¼45åº¦
                
                ctx.fillStyle = '#fff';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowColor = 'rgba(0,0,0,0.5)';
                ctx.shadowBlur = 2;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;
                
                if (isSmallSlice) {
                    // æ¥µå°æ‰‡å½¢ï¼šåªé¡¯ç¤ºé¦–å­—æ¯æˆ–ç¸®å¯«
                    displayText = displayText.length > 3 ? displayText.substring(0, 2) : displayText.substring(0, 1);
                    textFontSize = Math.max(14, textFontSize - 2);
                    
                    const textRadius = 120;
                    const textX = 200 + Math.cos(textAngle) * textRadius;
                    const textY = 200 + Math.sin(textAngle) * textRadius;
                    
                    ctx.save();
                    ctx.translate(textX, textY);
                    ctx.rotate(textAngle + Math.PI/2);
                    ctx.font = `bold ${textFontSize}px Arial`;
                    ctx.fillText(displayText, 0, 0);
                    ctx.restore();
                    
                } else if (isNarrowSlice) {
                    // è¼ƒå°æ‰‡å½¢ï¼šè±ç›´é¡¯ç¤ºï¼Œä½†å­—ç¬¦é–“è·ç·Šå¯†
                    if (displayText.length > 4) {
                        displayText = displayText.substring(0, 3) + 'â€¦';
                    }
                    
                    textFontSize = Math.max(12, textFontSize - 2);
                    const startRadius = 160;
                    const charSpacing = textFontSize * 0.9; // ç·Šå¯†é–“è·
                    
                    ctx.font = `bold ${textFontSize}px Arial`;
                    
                    for (let i = 0; i < displayText.length; i++) {
                        const char = displayText[i];
                        const charRadius = startRadius - (i * charSpacing);
                        
                        if (charRadius < 70) break;
                        
                        const charX = 200 + Math.cos(textAngle) * charRadius;
                        const charY = 200 + Math.sin(textAngle) * charRadius;
                        
                        ctx.save();
                        ctx.translate(charX, charY);
                        ctx.rotate(textAngle + Math.PI/2);
                        ctx.fillText(char, 0, 0);
                        ctx.restore();
                    }
                    
                } else {
                    // å¤§æ‰‡å½¢ï¼šæ°´å¹³é¡¯ç¤ºï¼Œå……åˆ†åˆ©ç”¨ç©ºé–“
                    if (displayText.length > 8) {
                        displayText = displayText.substring(0, 7) + 'â€¦';
                    }
                    
                    const textRadius = 120;
                    const textX = 200 + Math.cos(textAngle) * textRadius;
                    const textY = 200 + Math.sin(textAngle) * textRadius;
                    
                    // å‹•æ…‹èª¿æ•´å­—é«”å¤§å°
                    ctx.font = `bold ${textFontSize}px Arial`;
                    let textWidth = ctx.measureText(displayText).width;
                    const maxWidth = sliceAngle * 100; // æ ¹æ“šæ‰‡å½¢è§’åº¦è¨ˆç®—æœ€å¤§å¯¬åº¦
                    
                    while (textWidth > maxWidth && textFontSize > 10) {
                        textFontSize -= 1;
                        ctx.font = `bold ${textFontSize}px Arial`;
                        textWidth = ctx.measureText(displayText).width;
                    }
                    
                    ctx.save();
                    ctx.translate(textX, textY);
                    ctx.rotate(textAngle + Math.PI/2);
                    ctx.fillText(displayText, 0, 0);
                    ctx.restore();
                }

                currentAngle += sliceAngle;
            });
        }

        // æŠ½çåŠŸèƒ½
        function spinWheel() {
            if (isSpinning) return;
            
            const participants = getParticipants();
            if (participants.length === 0) {
                alert('è«‹æ·»åŠ è‡³å°‘ä¸€å€‹åƒèˆ‡è€…ï¼');
                return;
            }

            isSpinning = true;
            document.querySelector('.spin-btn').disabled = true;
            document.getElementById('result').textContent = 'æŠ½çä¸­...';

            // é‡æ–°ç¹ªè£½è¼ªç›¤
            drawWheel();

            // Step 1: ä½¿ç”¨æ¬Šé‡éš¨æ©Ÿé¸æ“‡ç²çè€…
            const totalWeight = participants.reduce((sum, p) => sum + p.weight, 0);
            const random = Math.random() * totalWeight;
            let accumWeight = 0;
            let winner = participants[0];
            let winnerIndex = 0;

            for (let i = 0; i < participants.length; i++) {
                accumWeight += participants[i].weight;
                if (random <= accumWeight) {
                    winner = participants[i];
                    winnerIndex = i;
                    break;
                }
            }

            // Step 2: è¨ˆç®—ç²çè€…åœ¨è¼ªç›¤ä¸Šçš„ä¸­å¿ƒè§’åº¦
            // é€™å€‹è¨ˆç®—å¿…é ˆèˆ‡ drawWheel() ä¸­çš„é‚è¼¯å®Œå…¨ä¸€è‡´
            let angle = 0;
            let winnerMidAngle = 0;
            
            for (let i = 0; i < participants.length; i++) {
                const sliceAngle = (participants[i].weight / totalWeight) * 2 * Math.PI;
                
                if (i === winnerIndex) {
                    // ç²çè€…æ‰‡å½¢çš„ä¸­å¿ƒè§’åº¦
                    winnerMidAngle = angle + sliceAngle / 2;
                    break;
                }
                
                angle += sliceAngle;
            }

            // Step 3: è¨ˆç®—æ—‹è½‰è§’åº¦
            // æŒ‡é‡å›ºå®šåœ¨é ‚éƒ¨ï¼ˆ12é»é˜ä½ç½®ï¼‰ï¼Œè½‰ç›¤éœ€è¦æ—‹è½‰è®“ç²çè€…å°æº–æŒ‡é‡
            // æŒ‡é‡ä½ç½®ï¼š-90åº¦ï¼ˆ12é»é˜ï¼‰
            const pointerPosition = -Math.PI / 2; // -90åº¦
            
            // CSS transform rotate æ˜¯é †æ™‚é‡çš„ï¼Œæˆ‘å€‘éœ€è¦è¨ˆç®—è½‰ç›¤è¦é †æ™‚é‡è½‰å¤šå°‘åº¦
            // è®“ç²çè€…çš„ä¸­å¿ƒè§’åº¦è½‰åˆ°æŒ‡é‡ä½ç½®
            let rotationNeeded = pointerPosition - winnerMidAngle;
            
            // æ¨™æº–åŒ–è§’åº¦ï¼Œç¢ºä¿åœ¨ -Ï€ åˆ° Ï€ ç¯„åœå…§
            while (rotationNeeded > Math.PI) rotationNeeded -= 2 * Math.PI;
            while (rotationNeeded < -Math.PI) rotationNeeded += 2 * Math.PI;
            
            // ç¢ºä¿è‡³å°‘è½‰3åœˆï¼Œæœ€å¤š5åœˆï¼ˆå¼·åˆ¶é †æ™‚é‡æ–¹å‘ï¼‰
            const minSpins = 3;
            const maxSpins = 5;
            const randomSpins = minSpins + Math.floor(Math.random() * (maxSpins - minSpins + 1));
            
            // å¦‚æœrotationNeededæ˜¯è² æ•¸ï¼ˆé€†æ™‚é‡ï¼‰ï¼ŒåŠ ä¸Š360åº¦è®“å®ƒè®Šæˆé †æ™‚é‡
            if (rotationNeeded < 0) {
                rotationNeeded += 2 * Math.PI;
            }
            
            const finalRotation = randomSpins * 2 * Math.PI + rotationNeeded;
            
            // éš¨æ©Ÿç”Ÿæˆæ—‹è½‰æ™‚é–“ï¼ˆ1-5ç§’ï¼‰
            const spinDuration = 1 + Math.random() * 4; // 1-5ç§’éš¨æ©Ÿ
            
            // èª¿è©¦ä¿¡æ¯ï¼ˆå¯ä»¥åœ¨ç€è¦½å™¨æ§åˆ¶å°æŸ¥çœ‹ï¼‰
            console.log('=== æŠ½çèª¿è©¦ä¿¡æ¯ ===');
            console.log('ç²çè€…:', winner.name, 'ç´¢å¼•:', winnerIndex);
            console.log('ç²çè€…ä¸­å¿ƒè§’åº¦:', (winnerMidAngle * 180 / Math.PI).toFixed(1), 'åº¦');
            console.log('éœ€è¦æ—‹è½‰è§’åº¦:', (rotationNeeded * 180 / Math.PI).toFixed(1), 'åº¦');
            console.log('éš¨æ©Ÿåœˆæ•¸:', randomSpins, 'åœˆ');
            console.log('æœ€çµ‚æ—‹è½‰è§’åº¦:', (finalRotation * 180 / Math.PI).toFixed(1), 'åº¦');
            console.log('æ—‹è½‰æ™‚é–“:', spinDuration.toFixed(1), 'ç§’');
            
            // Step 4: è¨­ç½®å‹•ç•«ä¸¦åŸ·è¡Œæ—‹è½‰
            const rotationDegrees = finalRotation * 180 / Math.PI;
            
            // é‡ç½®è½‰ç›¤ä½ç½®åˆ°0åº¦ï¼Œç„¶å¾Œè¨­ç½®å‹•ç•«
            canvas.style.transition = 'none';
            canvas.style.transform = 'rotate(0deg)';
            
            // å¼·åˆ¶é‡ç¹ªï¼Œç„¶å¾Œé–‹å§‹æ—‹è½‰å‹•ç•«
            canvas.offsetHeight; // è§¸ç™¼é‡ç¹ª
            
            canvas.style.transition = `transform ${spinDuration}s cubic-bezier(0.17, 0.67, 0.12, 0.99)`;
            canvas.style.transform = `rotate(${rotationDegrees}deg)`;

            // Step 5: é¡¯ç¤ºçµæœï¼ˆæ ¹æ“šéš¨æ©Ÿæ™‚é–“å»¶é²ï¼‰
            setTimeout(() => {
                document.getElementById('result').textContent = `ğŸ‰ æ­å–œ ${winner.name} ä¸­çï¼ğŸ‰`;
                addToResults(winner.name);
                isSpinning = false;
                document.querySelector('.spin-btn').disabled = false;
            }, spinDuration * 1000); // è½‰æ›ç‚ºæ¯«ç§’
        }

        // åˆå§‹åŒ–å‡½æ•¸
        function initializeWheel() {
            // ç‚ºæ‰€æœ‰ç¾æœ‰çš„åƒèˆ‡è€…è¼¸å…¥æ¡†æ·»åŠ äº‹ä»¶ç›£è½å™¨
            const existingInputs = document.querySelectorAll('#participants-container input');
            existingInputs.forEach(input => {
                input.addEventListener('input', drawWheel);
            });
            
            // åˆå§‹ç¹ªè£½è¼ªç›¤
            drawWheel();
        }
        
        // çµæœæ­·å²ç®¡ç†
        let resultsHistory = [];
        let currentLotteryTitle = '';
        
        function addToResults(winnerName) {
            const titleInput = document.getElementById('title-input');
            currentLotteryTitle = titleInput.value || 'åš•æ¯›å¤§è»ç©ºæŠ•è¼ªç›¤';
            
            // æ·»åŠ åˆ°æ­·å²è¨˜éŒ„
            resultsHistory.push(winnerName);
            
            // æ›´æ–°çµæœæ–‡æœ¬æ¡†
            updateResultsText();
        }
        
        function updateResultsText() {
            const resultsTextArea = document.getElementById('results-text');
            
            if (resultsHistory.length === 0) {
                resultsTextArea.value = '';
                return;
            }
            
            // ç¬¬ä¸€è¡Œé¡¯ç¤ºæŠ½çæ¨™é¡Œ
            let resultText = currentLotteryTitle + '\n';
            
            // ä¾åºé¡¯ç¤ºä¸­çè€…
            resultsHistory.forEach((name, index) => {
                resultText += `${index + 1}. ${name}\n`;
            });
            
            resultsTextArea.value = resultText;
        }
        
        function clearResults() {
            if (resultsHistory.length === 0) {
                alert('ç›®å‰æ²’æœ‰çµæœå¯ä»¥æ¸…é™¤ï¼');
                return;
            }
            
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æŠ½ççµæœå—ï¼Ÿ')) {
                resultsHistory = [];
                currentLotteryTitle = '';
                updateResultsText();
            }
        }
        
        function copyResults() {
            const resultsTextArea = document.getElementById('results-text');
            
            if (resultsTextArea.value.trim() === '') {
                alert('ç›®å‰æ²’æœ‰çµæœå¯ä»¥è¤‡è£½ï¼');
                return;
            }
            
            // è¤‡è£½åˆ°å‰ªè²¼æ¿
            resultsTextArea.select();
            resultsTextArea.setSelectionRange(0, 99999); // é©ç”¨æ–¼æ‰‹æ©Ÿè¨­å‚™
            
            try {
                document.execCommand('copy');
                alert('å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
            } catch (err) {
                // ä½¿ç”¨ç¾ä»£APIä½œç‚ºå‚™é¸
                navigator.clipboard.writeText(resultsTextArea.value).then(function() {
                    alert('å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
                }, function(err) {
                    alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸æ“‡æ–‡å­—è¤‡è£½');
                });
            }
        }

        // å•Ÿç”¨æ‰€æœ‰åƒèˆ‡è€…
        function enableAllParticipants() {
            const disabledEntries = document.querySelectorAll('.participant-entry.disabled');
            
            if (disabledEntries.length === 0) {
                alert('ç›®å‰æ²’æœ‰åœç”¨çš„åƒèˆ‡è€…ï¼');
                return;
            }
            
            disabledEntries.forEach(entry => {
                const disableBtn = entry.querySelector('.disable-btn');
                if (disableBtn) {
                    toggleParticipant(disableBtn);
                }
            });
        }

        // æ¸…ç©ºæ‰€æœ‰åƒèˆ‡è€…
        function clearAllParticipants() {
            if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰åƒèˆ‡è€…å—ï¼Ÿé€™å°‡åˆªé™¤æ‰€æœ‰ç¾æœ‰çš„åƒèˆ‡è€…ï¼Œåªä¿ç•™ä¸€å€‹ç©ºç™½æ¬„ä½ã€‚')) {
                return;
            }
            
            const container = document.getElementById('participants-container');
            
            // æ¸…ç©ºæ‰€æœ‰ç¾æœ‰çš„åƒèˆ‡è€…
            container.innerHTML = '';
            
            // æ·»åŠ ä¸€å€‹é è¨­çš„ç©ºç™½åƒèˆ‡è€…æ¬„ä½
            const entry = document.createElement('div');
            entry.className = 'participant-entry';
            entry.innerHTML = `
                <input type="text" placeholder="åƒèˆ‡è€…å§“å">
                <input type="number" placeholder="æ¬Šé‡" value="1" min="1">
                <div class="participant-buttons">
                    <button class="disable-btn" onclick="toggleParticipant(this)" title="åœç”¨/å•Ÿç”¨åƒèˆ‡è€…">âˆ’</button>
                    <button class="remove-btn" onclick="removeParticipant(this)" title="åˆªé™¤åƒèˆ‡è€…">Ã—</button>
                </div>
            `;
            container.appendChild(entry);
            
            // ç‚ºæ–°æ·»åŠ çš„è¼¸å…¥æ¡†æ·»åŠ äº‹ä»¶ç›£è½å™¨
            const inputs = entry.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', drawWheel);
            });
            
            // å³æ™‚æ›´æ–°è¼ªç›¤
            drawWheel();
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        initializeWheel();
    </script>
</body>
</html>